{% extends "base.html" %}

{% load static %}
{% load cloudinary %}

{% block title %}Photo Detail{% endblock %}

{% block content %}
<div class="photo-detail-container">
  <!-- Display the photo -->
  <img src="{{ photo.image.url }}" alt="{{ photo.title }}" class="img-fluid">

  <!-- Photo title -->
  <h2>{{ photo.title }}</h2>

  <!-- Photo owner -->
  <p class="photo-owner">By: {{ photo.user.username }}</p>

  <!-- Photo description -->
  <p>{{ photo.description }}</p>

  <!-- Like button -->
  <form method="post" action="{% url 'like_photo' photo.pk %}">
    {% csrf_token %}
    <button type="submit" class="like-button btn btn-outline-primary">
      {% if is_liked %}
      Unlike
      {% else %}
      Like
      {% endif %}
    </button>
  </form>

  <!-- Display the number of likes -->
  <p>{{ total_likes }} Likes</p>

  <!-- Comments Section -->
  <div class="comments-section">
    <h3>Comments</h3>
    {% if photo.comments.exists %}
    {% for comment in photo.comments.all %}
    <div class="comment">
      <strong>{{ comment.user.username }}</strong>
      <p>{{ comment.text }}</p>
      <small>{{ comment.created_at|date:"F j, Y, g:i a" }}</small>
    </div>
    {% endfor %}
    {% else %}
    <p>No comments yet. Be the first to comment!</p>
    {% endif %}
  </div>

  <!-- Comment Form -->
  {% if user.is_authenticated %}
  <form class="comment-form" method="post">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <button type="submit" class="btn btn-primary">Add Comment</button>
  </form>
  {% else %}
  <p>You must be <a href="{% url 'signin' %}">logged in</a> to add a comment.</p>
  {% endif %}
</div>
{% endblock %}